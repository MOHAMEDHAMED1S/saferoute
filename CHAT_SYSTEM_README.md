# ูุธุงู ุงูุดุงุช ุงููุฌุชูุนู - SafeRoute

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ูุธุงู ุงูุดุงุช ุงููุฌุชูุนู ููุนูู ูุน Firebase Firestore ุจุฏูุงู ูู API ุงูุฎุงุฑุฌู. ูููุฑ ุงููุธุงู ุงูููุฒุงุช ุงูุชุงููุฉ:

- ุฅุฑุณุงู ูุงุณุชูุจุงู ุงูุฑุณุงุฆู ูู ุงูููุช ุงููุนูู
- ุงูุชูุงุนู ูุน ุงูุฑุณุงุฆู (ุฅุนุฌุงุจุ ุฑุฏูุฏ ูุนู)
- ุชุนุฏูู ูุญุฐู ุงูุฑุณุงุฆู
- ุนุฑุถ ุนุฏุฏ ุงููุณุชุฎุฏููู ุงููุชุตููู
- ุฏุนู ุฃููุงุน ูุฎุชููุฉ ูู ุงูุฑุณุงุฆู (ูุตุ ุตูุฑุฉุ ูููุนุ ุชูุฑูุฑ ุญุงุฏุซ)

## ุฅุตูุงุญ ูุดููุฉ ุชุชุจุน ุงูุฑุณุงุฆู

### ุงููุดููุฉ
ูุงูุช ุงูุฑุณุงุฆู ูุง ุชูุชุชุจุน ุจุดูู ุตุญูุญ ูู ุงูููุช ุงููุนูู ุจุณุจุจ:
1. ุนุฏู ุงูุชุนุงูู ูุน ุฌููุน ุฃููุงุน ุงูุชุบููุฑุงุช ูู Firestore
2. ุนุฏู ูุฌูุฏ ูุนุงูุฌุฉ ููุฃุฎุทุงุก ูู ุงูู listeners
3. ุนุฏู ูุฌูุฏ ุขููุฉ ุฅุนุงุฏุฉ ุงูุงุชุตุงู ุนูุฏ ุงููุทุงุน ุงูุงุชุตุงู

### ุงูุญู
ุชู ุฅุตูุงุญ ุงููุดููุฉ ูู ุฎูุงู:

1. **ุชุญุณูู ุฏุงูุฉ `_startListeningToMessages()`**:
   - ุงูุชุนุงูู ูุน `DocumentChangeType.added` ู `DocumentChangeType.modified`
   - ุฅุถุงูุฉ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุน `onError`
   - ุฅุถุงูุฉ ุขููุฉ ุฅุนุงุฏุฉ ุงูุงุชุตุงู

2. **ุฅุถุงูุฉ ุฏุงูุฉ `_startListeningToOnlineUsers()`**:
   - ุชุชุจุน ุนุฏุฏ ุงููุณุชุฎุฏููู ุงููุชุตููู ูู ุงูููุช ุงููุนูู
   - ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุฅุนุงุฏุฉ ุงูุงุชุตุงู

3. **ุฅุถุงูุฉ ุฏุงูุฉ `_reconnectListeners()`**:
   - ุฅุนุงุฏุฉ ูุญุงููุฉ ุงูุงุชุตุงู ูู 5 ุซูุงูู ูู ุญุงูุฉ ุงููุทุงุน ุงูุงุชุตุงู
   - ุฅูุบุงุก ุงูู timer ุงูุณุงุจู ูุจู ุฅูุดุงุก ุฌุฏูุฏ

## ุงููููุงุช ุงููุญุฏุซุฉ

### 1. `lib/services/firebase_schema_service.dart`
- ุฅุถุงูุฉ ูุฌููุนุฉ `community_chat` ููุฑุณุงุฆู ุงููุฌุชูุนูุฉ
- ุชุญุฏูุซ ูุฎุทุท ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุดูู ูููู ุงูุฑุณุงุฆู

### 2. `lib/models/chat_message.dart`
- ุฅุถุงูุฉ ุญููู ุฌุฏูุฏุฉ: `messageType`, `metadata`, `editedAt`, `deletedAt`, `replyTo`, `reactions`
- ุฅุถุงูุฉ ุฏุงูุฉ `fromFirestore()` ู `toFirestore()`
- ุฏุนู ุฃููุงุน ูุฎุชููุฉ ูู ุงูุฑุณุงุฆู

### 3. `lib/services/community_service.dart`
- ุฅุนุงุฏุฉ ูุชุงุจุฉ ูุงููุฉ ูุชุนูู ูุน Firebase Firestore
- ุฅุถุงูุฉ ูุณุชูุนู ุงูุชุญุฏูุซุงุช ุงูููุฑูุฉ
- ุฏุนู ุงูุชูุงุนู ูุน ุงูุฑุณุงุฆู (ุฅุนุฌุงุจุ ุชุนุฏููุ ุญุฐู)
- ุฅุถุงูุฉ ุฏูุงู ุฌุฏูุฏุฉ ููุชูุงุนู ูุน ุงูุฑุณุงุฆู

### 4. `lib/models/community_post.dart` (ุฌุฏูุฏ)
- ูููุฐุฌ ููููุดูุฑุงุช ุงููุฌุชูุนูุฉ
- ุฏุนู Firebase Firestore

### 5. `lib/models/leaderboard_user.dart`
- ุฅุถุงูุฉ ุฏุงูุฉ `fromFirestore()`

## ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุชููุฆุฉ ุงูุฎุฏูุฉ

```dart
final communityService = CommunityService();
await communityService.initialize();
```

### 2. ุฅุฑุณุงู ุฑุณุงูุฉ

```dart
await communityService.sendChatMessage(
  userId: 'user123',
  userName: 'ุงุณู ุงููุณุชุฎุฏู',
  message: 'ูุฑุญุจุงู ุจุงูุฌููุน!',
  userAvatar: 'https://example.com/avatar.jpg',
  messageType: MessageType.text,
);
```

### 3. ุงูุงุณุชูุงุน ููุฑุณุงุฆู ุงูุฌุฏูุฏุฉ

```dart
communityService.messageStream.listen((message) {
  // ุงูุชุนุงูู ูุน ุงูุฑุณุงูุฉ ุงูุฌุฏูุฏุฉ
  print('ุฑุณุงูุฉ ุฌุฏูุฏุฉ: ${message.message}');
});
```

### 4. ุฌูุจ ุงูุฑุณุงุฆู ุงูููุฌูุฏุฉ

```dart
final messages = await communityService.getChatMessages();
```

### 5. ุงูุชูุงุนู ูุน ุงูุฑุณุงุฆู

```dart
// ุฅุถุงูุฉ ุชูุงุนู
await communityService.addReaction(messageId, userId, '๐');

// ุชุนุฏูู ุฑุณุงูุฉ
await communityService.editMessage(messageId, 'ุงููุต ุงูุฌุฏูุฏ');

// ุญุฐู ุฑุณุงูุฉ
await communityService.deleteMessage(messageId);
```

## ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ูุฌููุนุฉ `community_chat`

```json
{
  "messageId": {
    "userId": "string",
    "userName": "string",
    "userAvatar": "string?",
    "message": "string",
    "timestamp": "Timestamp",
    "isDelivered": "bool",
    "isRead": "bool",
    "messageType": "string", // text, image, location, incident_report
    "metadata": "Map<String, dynamic>?",
    "editedAt": "Timestamp?",
    "deletedAt": "Timestamp?",
    "replyTo": "string?",
    "reactions": "Map<String, List<String>>"
  }
}
```

## ุชุญุณููุงุช ูุงุฌูุฉ ุงููุณุชุฎุฏู

### 1. ุชุตููู ุงูุฑุณุงุฆู ุงูุฌุฏูุฏ
- **ุฑุณุงุฆู ุงููุณุชุฎุฏู ุงูุญุงูู**: ุชุธูุฑ ุนูู ุงููููู ุจููู ุฃุณุงุณู
- **ุฑุณุงุฆู ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู**: ุชุธูุฑ ุนูู ุงููุณุงุฑ ุจููู ุฑูุงุฏู ูุงุชุญ
- **ุดูู ููุงุนู**: ุฒูุงูุง ูุฏูุฑุฉ ูุน ุฐูู ุตุบูุฑ ูุดูุฑ ููุงุชุฌุงู
- **ุธูุงู ูุงุนูุฉ**: ูุฅุนุทุงุก ุนูู ุจุตุฑู ููุฑุณุงุฆู

### 2. ุชุฑุชูุจ ุงูุฑุณุงุฆู
- **ุงูุฑุณุงุฆู ุงูุฃูุฏู ูู ุงูุฃุนูู**: ููุง ูู ูุทููุจ
- **ุงูุฑุณุงุฆู ุงูุฃุญุฏุซ ูู ุงูุฃุณูู**: ูุชู ุฅุถุงูุชูุง ุชููุงุฆูุงู
- **ุชูุฑูุฑ ุณูุณ**: ูููุตูู ููุฑุณุงุฆู ุงููุฏููุฉ

### 3. ุงูุชูุงุนู ูุน ุงูุฑุณุงุฆู
- **ุงูุถุบุท ุงููุทูู**: ูุธูุฑ ูุงุฆูุฉ ุฎูุงุฑุงุช
- **ุงูุชูุงุนูุงุช**: ๐ โค๏ธ ๐
- **ุชุนุฏูู ูุญุฐู**: ูููุณุชุฎุฏู ุงูุญุงูู ููุท
- **ูุงุฆูุฉ ููุจุซูุฉ**: ุชุตููู ุฃููู ูุณูู ุงูุงุณุชุฎุฏุงู

### 4. ููุทูุฉ ุฅุฑุณุงู ุงูุฑุณุงุฆู
- **ุญูู ูุต ูุญุณู**: ุดูู ุฏุงุฆุฑู ูุน ุญุฏูุฏ ูุงุนูุฉ
- **ุฒุฑ ุฅุฑุณุงู ุฏุงุฆุฑู**: ุจููู ุฃุณุงุณู ูุน ุฃููููุฉ ุจูุถุงุก
- **ุฏุนู ุงูุฃุณุทุฑ ุงููุชุนุฏุฏุฉ**: ููุฑุณุงุฆู ุงูุทูููุฉ
- **ุธู ุนููู**: ููุตู ููุทูุฉ ุงูุฅุฑุณุงู ุนู ุงููุญุชูู

### 5. ุดุฑูุท ุงูุนููุงู
- **ููู ุฃุณุงุณู**: ูุชุณู ูุน ุงูุชุตููู
- **ุนุฏุงุฏ ุงููุณุชุฎุฏููู ุงููุชุตููู**: ูู ุดูู badge ุฃููู
- **ูุต ุนุฑุจู**: "X ูุชุตู" ุจุฏูุงู ูู ุงูุฃุฑูุงู ููุท

## ุงุฎุชุจุงุฑ ุงูุชุชุจุน

### 1. ุงุณุชุฎุฏุงู ุงูููู ุงูุชุฌุฑูุจู
```dart
// ูู main.dart
import 'package:saferoute/test/chat_test_screen.dart';

// ูู MaterialApp
home: const ChatTestScreen(),
```

### 2. ูุฑุงูุจุฉ ุงูู Debug Console
ุนูุฏ ุชุดุบูู ุงูุชุทุจููุ ุณุชุธูุฑ ุฑุณุงุฆู ูู ุงูู debug console:
```
ุฑุณุงูุฉ ุฌุฏูุฏุฉ ูุณุชููุฉ: ูุฑุญุจุงู ุจุงูุฌููุน!
ุชู ุฌูุจ 5 ุฑุณุงูุฉ ููุฌูุฏุฉ
ุชุญุฏูุซ ุนุฏุฏ ุงููุณุชุฎุฏููู ุงููุชุตููู: 3
ุฅุฑุณุงู ุฑุณุงูุฉ: ูุฑุญุจุงู ุจุงูุฌููุน!
ุชู ุฅุฑุณุงู ุงูุฑุณุงูุฉ ุจูุฌุงุญ: abc123
```

### 3. ุงุฎุชุจุงุฑ ุงูุชุชุจุน ูู ุงูููุช ุงููุนูู
1. ุงูุชุญ ุงูุชุทุจูู ุนูู ุฌูุงุฒูู ูุฎุชูููู
2. ุฃุฑุณู ุฑุณุงูุฉ ูู ุงูุฌูุงุฒ ุงูุฃูู
3. ูุฌุจ ุฃู ุชุธูุฑ ุงูุฑุณุงูุฉ ููุฑุงู ุนูู ุงูุฌูุงุฒ ุงูุซุงูู
4. ุฑุงูุจ ุงูู debug console ููุชุฃูุฏ ูู ุงุณุชูุงู ุงูุฑุณุงูุฉ

## ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1. ุฃููุงุน ุงูุฑุณุงุฆู
- `text`: ุฑุณุงุฆู ูุตูุฉ ุนุงุฏูุฉ
- `image`: ุฑุณุงุฆู ุชุญุชูู ุนูู ุตูุฑ
- `location`: ุฑุณุงุฆู ุชุญุชูู ุนูู ูููุน
- `incidentReport`: ุชูุงุฑูุฑ ุงูุญูุงุฏุซ

### 2. ุงูุชูุงุนู ูุน ุงูุฑุณุงุฆู
- ุฅุถุงูุฉ ูุฅุฒุงูุฉ ุงูุชูุงุนูุงุช (ุฅุนุฌุงุจุ ุญุจุ ุถุญูุ ุฅูุฎ)
- ุชุนุฏูู ุงูุฑุณุงุฆู
- ุญุฐู ุงูุฑุณุงุฆู (ุญุฐู ูุงุนู)

### 3. ุงูุชุญุฏูุซุงุช ุงูููุฑูุฉ
- ุงุณุชูุจุงู ุงูุฑุณุงุฆู ุงูุฌุฏูุฏุฉ ููุฑุงู
- ุชุญุฏูุซ ุนุฏุฏ ุงููุณุชุฎุฏููู ุงููุชุตููู
- ุชุญุฏูุซ ุงูุชูุงุนูุงุช ูู ุงูููุช ุงููุนูู

## ุงูุงุฎุชุจุงุฑ

ุชู ุฅูุดุงุก ููู `lib/test/chat_test_screen.dart` ูุงุฎุชุจุงุฑ ุฌููุน ูุธุงุฆู ุงูุดุงุช. ูููู ุงุณุชุฎุฏุงูู ููุชุฃูุฏ ูู ุนูู ุงููุธุงู ุจุดูู ุตุญูุญ.

## ููุงุญุธุงุช ูููุฉ

1. **ุงูุฃูุงู**: ุชุฃูุฏ ูู ุฅุนุฏุงุฏ ููุงุนุฏ ุงูุฃูุงู ุงูููุงุณุจุฉ ูู Firebase
2. **ุงูุฃุฏุงุก**: ุชู ุชุญุฏูุฏ ุญุฏ ุฃูุตู 50 ุฑุณุงูุฉ ูู ุงูุงุณุชุนูุงูุงุช ูุชุฌูุจ ุจุทุก ุงูุชุญููู
3. **ุงูุชุฎุฒูู**: ุงูุฑุณุงุฆู ุงููุญุฐููุฉ ูุง ุชูุญุฐู ูุนููุงู ุจู ุชูุญุฏุฏ ูู "ูุญุฐููุฉ"
4. **ุงูุชูุงุนู**: ูููู ูููุณุชุฎุฏููู ุงูุชูุงุนู ูุน ุงูุฑุณุงุฆู ุจุนุฏุฉ ุทุฑู

## ุงูุชุทููุฑ ุงููุณุชูุจูู

- [ ] ุฏุนู ุฑูุน ุงูุตูุฑ ูุน Firebase Storage
- [ ] ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช ููุฑูุฉ
- [ ] ุฏุนู ุงูุฑุณุงุฆู ุงูุฎุงุตุฉ
- [ ] ุฅุถุงูุฉ ูุธุงู ุงูุชุตูููุงุช ููููุดูุฑุงุช
- [ ] ุชุญุณูู ูุงุฌูุฉ ุงููุณุชุฎุฏู
